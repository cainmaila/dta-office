# NPC è³‡æ–™æ¶æ§‹é‡æ§‹æ–‡æª”

## æ¦‚è¿°

å®Œæˆäº† NPC è³‡æ–™æ¶æ§‹çš„é‡å¤§é‡æ§‹,å°‡**äººç‰©å®šç¾©**èˆ‡**ä½ç½®å‘ˆç¾æ–¹å¼**è§£è€¦,å¯¦ç¾äº†æ›´éˆæ´»ã€å¯ç¶­è­·çš„ç³»çµ±æ¶æ§‹ã€‚

## é‡æ§‹ç›®æ¨™

1. âœ… å°‡äººç‰©åŸºæœ¬è³‡æ–™ï¼ˆå§“åã€å°è©±ã€è§’è‰²å±¬æ€§ï¼‰èˆ‡å‘ˆç¾æ–¹å¼ï¼ˆç«™ç«‹/ç†±å€ï¼‰åˆ†é›¢
2. âœ… ä½¿ç”¨ ID é€²è¡Œæ˜ å°„,æ”¯æ´åŒä¸€äººç‰©å¤šå€‹ä½ç½®
3. âœ… ç‚º LLM å°è©±åŠŸèƒ½é ç•™ `introduction` æ¬„ä½
4. âœ… çµ±ä¸€è³‡æ–™ç®¡ç†,æ¸›å°‘é‡è¤‡å’Œä¸ä¸€è‡´

## æ–°æ¶æ§‹è¨­è¨ˆ

### è³‡æ–™çµæ§‹

#### 1. äººç‰©åŸºæœ¬è³‡æ–™ (`Character`)

```typescript
interface Character {
    id: string; // å”¯ä¸€è­˜åˆ¥ç¢¼ (å¦‚ "zhang_manager")
    name: string; // å§“å
    position: string; // è·ç¨±
    personality: string; // å€‹æ€§æ¨™ç±¤
    dialogue: string; // ç•¶å‰å°è©±å…§å®¹
    introduction: string; // è‡ªæˆ‘ä»‹ç´¹ï¼ˆè©³ç´°ç‰ˆ,ç”¨æ–¼ LLMï¼‰
}
```

#### 2. ç«™ç«‹ NPC é…ç½® (`StandingNpcConfig`)

```typescript
interface StandingNpcConfig {
    characterId: string; // å°æ‡‰ Character.id
    x: number; // è³‡æ–™åº§æ¨™ X
    y: number; // è³‡æ–™åº§æ¨™ Y
    styleId: string; // NPC æ¨£å¼ (å¦‚ "business_male_1")
    action?: string; // å‹•ä½œç‹€æ…‹ (å¦‚ "idle")
}
```

#### 3. ç†±å€ NPC é…ç½® (`HotspotNpcConfig`)

```typescript
interface HotspotNpcConfig {
    characterId: string; // å°æ‡‰ Character.id
    x: number; // è³‡æ–™åº§æ¨™ X
    y: number; // è³‡æ–™åº§æ¨™ Y
    radius: number; // ç†±å€åŠå¾‘
    bubbleOffsetX?: number;
    bubbleOffsetY?: number;
    bubbleGap?: number;
}
```

### æª”æ¡ˆçµæ§‹

```
src/game/data/
  â””â”€â”€ characters.json     # çµ±ä¸€è³‡æ–™æª”æ¡ˆ
      â”œâ”€â”€ characters[]    # äººç‰©åŸºæœ¬è³‡æ–™ (11 ä½)
      â”œâ”€â”€ standingNpcs[]  # ç«™ç«‹ NPC é…ç½® (2 ä½)
      â””â”€â”€ hotspotNpcs[]   # ç†±å€ NPC é…ç½® (6 ä½)
```

## é·ç§»çš„äººç‰©è³‡æ–™

### ç«™ç«‹ NPC (2 ä½)

-   **å¼µä¸»ç®¡** (`zhang_manager`) - æŠ€è¡“ä¸»ç®¡,é ˜å°é¢¨ç¯„
-   **æ—åŠ©ç†** (`lin_assistant`) - è¡Œæ”¿åŠ©ç†,è¦ªåˆ‡ç†±å¿ƒ

### ç†±å€ NPC (6 ä½)

-   **ä¸»æŒäººè‰¾é”** (`ada_host`) - æœƒè­°ä¸»æŒäºº,æ¢ç†æ¸…æ™°
-   **è¡ŒéŠ·å°ˆå“¡å°æƒ ** (`hui_marketing`) - è¡ŒéŠ·å°ˆå“¡,æ´»æ½‘ç©æ¥µ
-   **è³‡æ–™åˆ†æå¸«å¯èŠ¸** (`keyun_analyst`) - è³‡æ–™åˆ†æå¸«,é‚è¼¯ç¸å¯†
-   **æŠ€è¡“é¡§å•é˜¿å“²** (`azhe_tech`) - æŠ€è¡“é¡§å•,å‹™å¯¦å‰µæ–°
-   **å°ˆæ¡ˆå”èª¿å¸«æ€¡å›** (`yijun_coordinator`) - å°ˆæ¡ˆå”èª¿å¸«,ç´°å¿ƒå‘¨åˆ°
-   **è³‡æ·±å°ˆå“¡** (`senior_specialist`) - è³‡æ·±å°ˆå“¡,ç¶“é©—è±å¯Œ

### æœªä½¿ç”¨çš„èˆŠäººç‰© (ä¿ç•™åœ¨è³‡æ–™ä¸­ä¾›æœªä¾†ä½¿ç”¨)

-   **æç¶“ç†** (`li_manager`) - ç”¢å“ç¶“ç†,åš´è¬¹è² è²¬
-   **ç‹è¨­è¨ˆå¸«** (`wang_designer`) - UI/UX è¨­è¨ˆå¸«,å‰µæ„æ»¿æ»¿
-   **é™³å·¥ç¨‹å¸«** (`chen_engineer`) - å‰ç«¯å·¥ç¨‹å¸«,æŠ€è¡“å°ˆç²¾

## ç¨‹å¼ç¢¼è®Šæ›´

### æ–°å¢æª”æ¡ˆ

-   `src/game/data/characters.json` - çµ±ä¸€çš„äººç‰©èˆ‡é…ç½®è³‡æ–™

### ä¿®æ”¹æª”æ¡ˆ

#### 1. `src/game/types/NPCTypes.ts`

-   âœ… æ–°å¢ `Character`, `StandingNpcConfig`, `HotspotNpcConfig`, `CharactersData` é¡å‹
-   âœ… ä¿ç•™èˆŠé¡å‹ (`NPCData`, `HotspotNPC`) ä»¥æ”¯æ´æ¼¸é€²å¼é·ç§»

#### 2. `src/game/managers/NPCManager.ts`

-   âœ… æ–°å¢ `characters` Map å„²å­˜äººç‰©è³‡æ–™åº«
-   âœ… æ”¹ç‚ºå¾ `characters.json` è¼‰å…¥è³‡æ–™
-   âœ… æ–°å¢ `getCharacter()` å’Œ `getAllCharacters()` æ–¹æ³•
-   âœ… å…§éƒ¨å°‡æ–°æ ¼å¼è½‰æ›ç‚º NPC ç‰©ä»¶æ‰€éœ€çš„èˆŠæ ¼å¼(æ¼¸é€²å¼é·ç§»)

#### 3. `src/game/scenes/Game.ts`

-   âœ… æ–°å¢ `characters` Map å„²å­˜äººç‰©è³‡æ–™åº«
-   âœ… æ”¹ç‚ºå¾ `characters.json` è¼‰å…¥è³‡æ–™
-   âœ… `loadStandingNPCs()` é‡å‘½åç‚º `loadCharactersAndNPCs()`
-   âœ… `createRoundTableHotspots()` æ¥å— `HotspotNpcConfig[]` åƒæ•¸
-   âœ… ç§»é™¤å° `roundTableNpcs.ts` çš„ä¾è³´

### åˆªé™¤æª”æ¡ˆ

-   âŒ `src/game/data/roundTableNpcs.ts` - å·²æ•´åˆåˆ° characters.json
-   âŒ `src/game/data/npcs.json` - å·²æ•´åˆåˆ° characters.json (å¯æ‰‹å‹•åˆªé™¤)

## ä½¿ç”¨ç¯„ä¾‹

### 1. å–å¾—äººç‰©è³‡æ–™

```typescript
// åœ¨ NPCManager ä¸­
const character = this.npcManager.getCharacter("zhang_manager");
console.log(character?.introduction); // LLM ç”¨çš„è‡ªæˆ‘ä»‹ç´¹

// åœ¨ Game å ´æ™¯ä¸­
const character = this.characters.get("zhang_manager");
console.log(character?.name); // "å¼µä¸»ç®¡"
```

### 2. æ–°å¢ç«™ç«‹ NPC

åœ¨ `characters.json` ä¸­:

```json
{
    "characters": [
        {
            "id": "new_character",
            "name": "æ–°è§’è‰²",
            "position": "è·ä½",
            "personality": "å€‹æ€§",
            "dialogue": "å°è©±å…§å®¹",
            "introduction": "è©³ç´°è‡ªæˆ‘ä»‹ç´¹..."
        }
    ],
    "standingNpcs": [
        {
            "characterId": "new_character",
            "x": 400,
            "y": 300,
            "styleId": "business_male_1"
        }
    ]
}
```

### 3. æ–°å¢ç†±å€ NPC

```json
{
    "hotspotNpcs": [
        {
            "characterId": "new_character",
            "x": 500,
            "y": 400,
            "radius": 40,
            "bubbleGap": 18
        }
    ]
}
```

### 4. åŒä¸€äººç‰©å¤šå€‹ä½ç½®

```json
{
    "standingNpcs": [
        {
            "characterId": "zhang_manager",
            "x": 200,
            "y": 300,
            "styleId": "business_male_1"
        }
    ],
    "hotspotNpcs": [
        {
            "characterId": "zhang_manager",
            "x": 500,
            "y": 400,
            "radius": 40
        }
    ]
}
```

## ID å‘½åè¦ç¯„

ä½¿ç”¨ **æ‹¼éŸ³ + è·ä½** çš„å‘½åæ–¹å¼:

-   `zhang_manager` - å¼µä¸»ç®¡
-   `lin_assistant` - æ—åŠ©ç†
-   `ada_host` - è‰¾é”ä¸»æŒäºº
-   `hui_marketing` - å°æƒ è¡ŒéŠ·å°ˆå“¡

## å¾ŒçºŒè¦åŠƒ

### çŸ­æœŸ (å·²å®Œæˆ)

-   âœ… è³‡æ–™æ¶æ§‹è§£è€¦
-   âœ… é·ç§»æ‰€æœ‰ç¾æœ‰ NPC
-   âœ… ä¿æŒåŠŸèƒ½å®Œå…¨ç›¸åŒ

### ä¸­æœŸ (å¾…å¯¦ä½œ)

-   ğŸ”„ å¤šè¼ªå°è©±ç³»çµ± (ç›®å‰ç‚ºå–®å¥)
-   ğŸ”„ LLM æ•´åˆä½¿ç”¨ `introduction` æ¬„ä½
-   ğŸ”„ æ ¹æ“šéŠæˆ²ç‹€æ…‹å‹•æ…‹æ”¹è®Šå°è©±å…§å®¹

### é•·æœŸ (è¦åŠƒä¸­)

-   ğŸ“‹ äººç‰©é—œä¿‚ç³»çµ±
-   ğŸ“‹ å°è©±æ­·å²è¨˜éŒ„
-   ğŸ“‹ äººç‰©ç‹€æ…‹ç®¡ç†
-   ğŸ“‹ æ›´è±å¯Œçš„äº’å‹•æ–¹å¼

## æ¸¬è©¦é©—è­‰

### æ¸¬è©¦é …ç›®

-   âœ… ç«™ç«‹ NPC æ­£å¸¸é¡¯ç¤º (å¼µä¸»ç®¡ã€æ—åŠ©ç†)
-   âœ… ç†±å€ NPC æ­£å¸¸é¡¯ç¤º (6 ä½åœ“æ¡Œæˆå“¡)
-   âœ… åå­—æ¨™ç±¤å‹•æ…‹é¡¯ç¤º (hover || dialogue)
-   âœ… å°è©±æ¡†æ­£å¸¸å½ˆå‡ºä¸¦é¡¯ç¤ºæ­£ç¢ºå…§å®¹
-   âœ… å»ºç½®ç„¡éŒ¯èª¤

### é©—è­‰æ–¹æ³•

1. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨: `pnpm run dev`
2. hover ä»»æ„ NPC æŸ¥çœ‹åå­—æ¨™ç±¤
3. é»æ“Š NPC æŸ¥çœ‹å°è©±æ¡†å…§å®¹
4. ç¢ºèªæ‰€æœ‰äººç‰©å§“åå’Œå°è©±æ­£ç¢º

## æ³¨æ„äº‹é …

1. **å‘å¾Œç›¸å®¹**: ä¿ç•™äº†èˆŠçš„é¡å‹å®šç¾© (`NPCData`, `HotspotNPC`),å…§éƒ¨æœƒè‡ªå‹•è½‰æ›
2. **æ¼¸é€²å¼é·ç§»**: NPC å’Œ DialogueBubble é¡åˆ¥ä»ä½¿ç”¨èˆŠæ ¼å¼,æœªä¾†å¯é€²ä¸€æ­¥é‡æ§‹
3. **è³‡æ–™å®Œæ•´æ€§**: æ‰€æœ‰ 11 ä½äººç‰©éƒ½æœ‰å®Œæ•´çš„ `introduction` æ¬„ä½ä¾› LLM ä½¿ç”¨
4. **å¤šä½ç½®æ”¯æ´**: åŒä¸€ `characterId` å¯å‡ºç¾åœ¨å¤šå€‹é…ç½®é™£åˆ—ä¸­

## æ•ˆç›Šç¸½çµ

### æ¶æ§‹å±¤é¢

-   âœ… **è§£è€¦åˆ**: äººç‰©è³‡æ–™èˆ‡å‘ˆç¾æ–¹å¼å®Œå…¨åˆ†é›¢
-   âœ… **å¯æ“´å±•**: è¼•é¬†æ–°å¢æ–°çš„å‘ˆç¾æ–¹å¼ (å¦‚ç§»å‹• NPC)
-   âœ… **å¯ç¶­è­·**: é›†ä¸­ç®¡ç†äººç‰©è³‡æ–™,é¿å…é‡è¤‡

### é–‹ç™¼å±¤é¢

-   âœ… **DRY åŸå‰‡**: äººç‰©è³‡æ–™ä¸å†é‡è¤‡å®šç¾©
-   âœ… **é¡å‹å®‰å…¨**: TypeScript å®Œæ•´é¡å‹å®šç¾©
-   âœ… **æ˜“æ–¼æ¸¬è©¦**: è³‡æ–™èˆ‡é‚è¼¯åˆ†é›¢

### æœªä¾†ç™¼å±•

-   âœ… **LLM æº–å‚™**: `introduction` æ¬„ä½å·²å°±ç·’
-   âœ… **éˆæ´»é…ç½®**: æ”¯æ´åŒä¸€äººç‰©å¤šç¨®å‘ˆç¾
-   âœ… **æ“´å±•æ€§**: æ˜“æ–¼æ–°å¢äººç‰©å’Œé…ç½®

---

**é‡æ§‹å®Œæˆæ—¥æœŸ**: 2025 å¹´ 10 æœˆ 1 æ—¥
**å»ºç½®ç‹€æ…‹**: âœ… æˆåŠŸ
**æ¸¬è©¦ç‹€æ…‹**: âœ… é€šé
