# 對話框位置調整說明

## 問題
站立的 NPC 對話框位置過於靠近人物，視覺上擁擠。

## 解決方案

### 調整內容

#### 1. NPC.ts - 增加對話框偏移量
```typescript
// 之前
bubbleOffsetY: -20,

// 之後
bubbleOffsetY: -60,  // 增加垂直偏移
bubbleGap: 30,       // 增加氣泡間隙
```

#### 2. DialogueManager.ts - 修正偏移量計算邏輯

**問題**: 原本的邏輯中，`bubbleOffsetY` 會直接替換預設值 `-150`，導致傳入較小的負值（如 `-60`）反而讓對話框更靠近人物。

**修正**: 將 `bubbleOffsetY` 改為額外偏移量，與基礎偏移量相加。

```typescript
// 之前
const defaultOffset = bubbleOffsetY ?? -150;
targetY = anchorY + defaultOffset;

// 之後
const baseOffset = -150;        // 基礎偏移量
const extraOffset = bubbleOffsetY ?? 0;  // 額外偏移量
targetY = anchorY + baseOffset + extraOffset;
```

## 效果

### 站立 NPC 對話框位置計算

```
最終 Y 座標 = anchorY + baseOffset + extraOffset
           = anchorY + (-150) + (-60)
           = anchorY - 210
```

這讓對話框距離 NPC 頭頂更遠，視覺上更舒適。

## 參數說明

### NPC 對話框參數
- **anchorY**: NPC 頭頂的 Y 座標（`this.y - this.height * this.scaleY`）
- **baseOffset**: 基礎偏移量 = `-150` 像素
- **bubbleOffsetY**: 額外向上偏移 = `-60` 像素
- **bubbleGap**: 氣泡間隙 = `30` 像素（用於未來的多氣泡場景）

### 圓桌 NPC（有 radius）
對於圓桌 NPC（hotspot 類型），計算方式不同：
```
targetY = anchorY - radius - tailSize - bubbleHeight/2 - gap + bubbleOffsetY
```

## 可調整參數

如果需要進一步調整對話框距離，可以修改：

### 讓對話框更遠離人物
```typescript
// 在 NPC.ts 中增加 bubbleOffsetY 的負值
bubbleOffsetY: -80,  // 原本 -60，增加到 -80
```

### 讓對話框更靠近人物
```typescript
bubbleOffsetY: -40,  // 減少負值
```

### 調整基礎偏移（全局影響）
```typescript
// 在 DialogueManager.ts 中修改 baseOffset
const baseOffset = -180;  // 增加基礎偏移
```

## 測試建議

1. 點擊不同的站立 NPC，檢查對話框位置
2. 確認對話框不會與 NPC 圖形重疊
3. 確認對話框尾巴（tail）指向正確位置
4. 檢查對話框是否在畫面範圍內（clamped）

## 相關檔案

- `src/game/objects/NPC.ts` - NPC 類別，設定對話框參數
- `src/game/managers/DialogueManager.ts` - 對話管理器，計算對話框位置
- `src/game/objects/DialogueBubble.ts` - 對話框類別
